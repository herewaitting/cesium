<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta http-equiv="X-UA-Compatible" content="ie=edge" />
        <title>史廷春Demo</title>
        <style>
            * {
                padding: 0;
                margin: 0;
            }
            html,
            body,
            #app {
                position: relative;
                height: 100%;
            }
        </style>
        <link rel="stylesheet" href="./Build/CesiumUnminified/Widgets/Widgets.css" />
        <script src="./Build/CesiumUnminified/Cesium.js"></script>
        <script src="./data.js"></script>
        <script src="./yanmo.js"></script>
        <script src="./jiancai.js"></script>
    </head>
    <body>
        <div id="app"></div>
        <script>
            var viewer = new Cesium.Viewer("app",{
                terrainProvider: new Cesium.ArcGISTiledElevationTerrainProvider({
                    url:
                    "https://elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/Terrain3D/ImageServer",
                })
            });
            let newPos = [];
            bianjie.forEach(function(item) {
                newPos.push({
                    longitude: item[0],
                    latitude: item[1]
                });
            });
            const poss = [
                {
                    longitude: 90,
                    latitude: 30,
                },
                {
                    longitude: 90.2,
                    latitude: 30.2,
                },
                {
                    longitude: 90,
                    latitude: 31,
                },
                {
                    longitude: 91,
                    latitude: 31,
                },
                {
                    longitude: 90.8,
                    latitude: 30.5,
                },
                {
                    longitude: 91,
                    latitude: 30,
                },
            ];
            var myyanmo;
             myyanmo = new YanMo(viewer, {
                positions: newPos,
                speed: 0.1,
                minHeight: 4740,
                maxHeight: 7500,
            });
            var myjiancai;
            // myjiancai = new Tailor(viewer, {
            //     positions: newPos,
            // });

            // let poss = [
            //     [90, 30],
            //     [90,31],
            //     [91,31],
            //     [91,30]
            // ];
            // let wldps = [];
            // poss.forEach((item) => {
            //     wldps.push(Cesium.Cartesian3.fromDegrees(item[0], item[1]));
            // });

            // var polygon = new Cesium.PolygonGeometry({
            //     polygonHierarchy : new Cesium.PolygonHierarchy(wldps)
            // });
            // // var geometry = Cesium.PolygonGeometry.createGeometry(polygon);
            // const pi = new Cesium.GeometryInstance({
            //     geometry : polygon,
            //     attributes : {
            //         color : Cesium.ColorGeometryInstanceAttribute.fromColor(Cesium.Color.RED)
            //     },
            //     id : 'top'
            // });
            // const stc =  viewer.scene.primitives.add(new Cesium.GroundPrimitive({
            //     geometryInstances : pi
            // }));
            // const context = viewer.scene.context;
            // var  brightColorT = new Cesium.Texture({
            //     context: context,
            //     width: context.drawingBufferWidth,
            //     height: context.drawingBufferHeight,
            //     pixelFormat : Cesium.PixelFormat.RGBA,
            //     pixelDatatype : Cesium.PixelDatatype.FLOAT,
            //     flipY : false
            // });
    
            // var brightColorFbo = new Cesium.Framebuffer({
            //     context: context,
            //     colorTextures: [brightColorT],
            //     // depthStencilTexture : depthStencilTexture,
            //     // destroyAttachments : false
            // });

            // // var  brightColorT1 = new Cesium.Texture({
            // //     context: context,
            // //     width: context.drawingBufferWidth,
            // //     height: context.drawingBufferHeight,
            // //     pixelFormat : Cesium.PixelFormat.RGBA,
            // //     pixelDatatype : Cesium.PixelDatatype.FLOAT,
            // //     flipY : false
            // // });
    
            // // var brightColorFbo1 = new Cesium.Framebuffer({
            // //     context: context,
            // //     colorTextures: [brightColorT1],
            // //     // depthStencilTexture : depthStencilTexture,
            // //     // destroyAttachments : false
            // // });




            // stc._clearCommand = new Cesium.ClearCommand({
            // color: new Cesium.Color(0.0, 0.0, 0.0, 0.0),
            // depth: 1.0,
            // stencil: 0,
            // });
            // stc._clearCommand.framebuffer = brightColorFbo;

            // function test() {
            //     stc.customFramebuffer = brightColorFbo;
            //     Cesium.ExtendBySTC.tailorArea = brightColorFbo;
            //     viewer.scene.globe._surface._tileProvider.applyTailor = true;
            // }

            // // function testFlood(){
            // //     stc.customFramebuffer = brightColorFbo;
            // //     Cesium.ExtendBySTC.floodArea = brightColorFbo;
            // //     viewer.scene.globe.material = Cesium.Material.fromType("TAILOR");
            // // }

            // // viewer.scene._postRender.addEventListener(function() {
            // //     stc._clearCommand.execute(context);
            // // });


            function test() {
                var fragmentShaderSource =
                    'uniform sampler2D colorTexture; \n' +
                    'uniform sampler2D daoyingTexture; \n' +
                    'varying vec2 v_textureCoordinates; \n' +
                    'void main(void) \n' +
                    '{ \n' +
                    '    vec4 daoying = texture2D(daoyingTexture, v_textureCoordinates); \n' +
                    '    gl_FragColor = daoying; \n' +
                    '} \n';
                viewer.scene.postProcessStages.add(new Cesium.PostProcessStage({
                    fragmentShader : fragmentShaderSource,
                    uniforms:{
                        daoyingTexture:function(){
                            return myjiancai && myjiancai.yanmoFbo._colorTextures[0] || myyanmo && myyanmo.yanmoFbo._colorTextures[0]
                        }
                    }
                }));
            }


        </script>
    </body>
</html>
